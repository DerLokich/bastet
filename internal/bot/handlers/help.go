package handlers

import (
	"log"

	"BastetTetlegram/internal/services"
	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

type HelpHandler struct {
	bot *tgbotapi.BotAPI
}

func NewHelpHandler(bot *tgbotapi.BotAPI) *HelpHandler {
	return &HelpHandler{
		bot: bot,
	}
}

func (h *HelpHandler) Handle(update tgbotapi.Update) {
	// –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ [—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –±–æ—Ç–∞](tg://user?id=435809098) –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–æ–π —Ä–∞–Ω–µ–µ.
	// –ï—Å–ª–∏ –º—ã —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç, –æ–Ω–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
	// –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, —É–±–µ—Ä–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –∏–∑ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
	originalText := "–ü—Ä–∏–≤–µ—Çüëã! –≠—Ç–æ —Å–≤–æ–±–æ–¥–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞. –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –±–æ—Ç–∞ (tg://user?id=435809098) üì¨.\n" +
		" –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—åüòä!\n\n–ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n" +
		"- `/gpt` - –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ–º–æ—â—å—é *GPT4o*.\n" +
		"- `/imagine` - –°–æ–∑–¥–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è.\n" +
		"- `/q` - –ü–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Ü–∏—Ç–∞—Ç—É.\n" +
		"- `/toast` - –ü–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π —Ç–æ—Å—Ç.\n"

	// –í–∞—Ä–∏–∞–Ω—Ç 2: –° —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–∞–¥–µ–∂–Ω–æ)
	escapedText := services.EscapeMarkdownV2(originalText)
	msg := tgbotapi.NewMessage(update.Message.Chat.ID, escapedText)

	msg.ParseMode = "MarkdownV2"
	_, err := h.bot.Send(msg)
	if err != nil {
		log.Printf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è /help: %v", err)
	}
}
