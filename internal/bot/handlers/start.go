package handlers

import (
	"log"

	"BastetTetlegram/internal/services"
	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

type StartHandler struct {
	bot *tgbotapi.BotAPI
}

func NewStartHandler(bot *tgbotapi.BotAPI) *StartHandler {
	return &StartHandler{
		bot: bot,
	}
}

func (h *StartHandler) Handle(update tgbotapi.Update) {
	originalText := "üëã *–ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî —Ç–≤–æ–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.*\n\n" +
		"–Ø —É–º–µ—é:\n" +
		"ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã —Å –ø–æ–º–æ—â—å—é *ChatGPT*.\n" +
		"üé® –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é *DALL-E*.\n" +
		"*–ö–∞–∫ –º–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?*\n" +
		"1. –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É /gpt, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n" +
		"   - \"/gpt –ù–∞–ø–∏—à–∏ —Ä–∞—Å—Å–∫–∞–∑ –ø—Ä–æ –∫–æ—Å–º–æ—Å\"\n" +
		"   - \"/gpt –ü—Ä–∏–¥—É–º–∞–π –∏–¥–µ—é –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–∞\"\n" +
		"2. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É `/imagine` –∏ –æ–ø–∏—à–∏, —á—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n" +
		"   - \"/imagine –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å –≤ —Å—Ç–∏–ª–µ –∫–∏–±–µ—Ä–ø–∞–Ω–∫\"\n" +
		"*–ù–∞—á–Ω–µ–º? –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ!*\n\n" +
		"*P.S.* –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É `/help` üòä"

	// –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ StartHandler –ù–ï —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç,
	// —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MarkdownV2 –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É.
	// –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ä–µ—à–µ–Ω–∏–∏,
	// —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç —Å–ª–æ–º–∞–Ω–æ.
	// –í —Ç–µ–∫—É—â–µ–º –ø–æ–¥—Ö–æ–¥–µ (–±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π) —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.
	// –û–¥–Ω–∞–∫–æ, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ–ø—ã—Ç, —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫–∏.
	// –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –º–æ–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç,
	// –Ω–æ —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å `[...](...)` –∏ `*` –∏ `_` –∏–∑ –Ω–µ–≥–æ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–∞—á–µ.

	// –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ä–∏—Å–∫–∏ –æ—à–∏–±–æ–∫)
	// msg := tgbotapi.NewMessage(update.Message.Chat.ID, originalText)

	// –í–∞—Ä–∏–∞–Ω—Ç 2: –° —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–∞–¥–µ–∂–Ω–æ)
	escapedText := services.EscapeMarkdownV2(originalText)
	msg := tgbotapi.NewMessage(update.Message.Chat.ID, escapedText)

	msg.ParseMode = "MarkdownV2"
	_, err := h.bot.Send(msg)
	if err != nil {
		log.Printf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è /start: %v", err)
	}
}
